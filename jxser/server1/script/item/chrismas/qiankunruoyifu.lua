Include([[\script\item\chrismas\chrismasitem.lua]]); 
Include([[\script\lib\coordinate.lua]]); 

tabidx = 0; 
function main() 
tabidx = itemmapcheck(TAB_ACTION); 
if (0 == tabidx) then 
return 1; 
end; 
local i; 
local nGroupId = GetTask(TAB_ACTION[tabidx][3]); 
if (TAB_ACTION[tabidx][5][1] == 1) then 
nGroupId = getgroupid(nGroupId, TAB_ACTION[tabidx][5][2]); 
end; 
local OldPlayer = PlayerIndex; 
local tabPlayer = {}; 

local szName; 
local idx = 0; 
local pidx; 
local j = 1; 
	for i = 1, TAB_ACTION[tabidx][4] + 5 do
idx, pidx = GetNextPlayer(TAB_ACTION[tabidx][2], idx, nGroupId); 
if (pidx > 0 and pidx ~= OldPlayer) then -- script viet hoa By http://tranhba.com  lùa chän trõ nhµ ch¬i bªn ngoµi ®Ých tÊt c¶ ®èi thñ # 
PlayerIndex = pidx; 
szName = GetName(); 
tabPlayer[j] = make_option("useqk"); 
			j = j + 1;
end; 

if (0 == idx) then 
break; 
end; 
end; 

PlayerIndex = OldPlayer; 
	tabPlayer[ getn(tabPlayer) + 1 ] = "È¡Ïû/giveback_yu"
Say("Ng­¬i sÏ ®èi c¸i nµo ®èi thñ sö dông ®¹o cô <color=0xB5FDD7> cµn kh«n na di phï <color> ? ", getn(tabPlayer), tabPlayer); 
end; 

function useqk(szName) 
local pidx = check_pl(szName, TAB_ACTION[tabidx][2]) 
if (not pidx) then 
giveback_yu() 
return 
end 

local OldName = GetName() 
local OldPlayer = PlayerIndex; 
PlayerIndex = pidx; 

local nBeginMapID = GetMissionV(TAB_ACTION[tabidx][6]); 
local nGroupId = GetTask(TAB_ACTION[tabidx][3]); 

	local nMapId = nBeginMapID + nGroupId - 1;
	nMapId = mod(nMapId, TAB_ACTION[tabidx][9]) + 1;
	local PosX, PosY = getadatatow(TAB_ACTION[tabidx][8], 8 + 8 * nMapId, 15 + 8 * nMapId);
PlayerIndex = pidx; 
SetPos(floor(PosX / 32), floor(PosY / 32)); 

Msg2Player("<#><color=0xB5FDD7>"..OldName.."<color> ®èi víi ng­¬i sö dông mét <color=0xB5FDD7> cµn kh«n na di phï <color> , ®¸nh lo¹n vÞ trÝ cña ng­¬i . "); 
PlayerIndex = OldPlayer; 
Msg2Player("<#> ng­¬i ®èi víi <color=0xB5FDD7>"..szName.."<color> sö dông mét <color=0xB5FDD7> cµn kh«n na di phï <color> , ®¸nh lo¹n vÞ trÝ cña h¾n . "); 
end; 

function giveback_yu() 
AddItem(6,1,985,1,0,0,0) 
end 
